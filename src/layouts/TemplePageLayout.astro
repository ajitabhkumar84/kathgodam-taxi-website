---
import Navbar from '../components/Navbar.astro';
import RouteHeroSlider from '../components/RouteHeroSlider.astro';
import Footer from '../components/Footer.astro';
import AttractionsGrid from '../components/AttractionsGrid.astro';
import RoutePricingTable from '../components/RoutePricingTable.astro';
import WhatsAppFAB from '../components/WhatsAppFAB.astro';
import GlobalHeadScripts from '../components/GlobalHeadScripts.astro';
import GlobalBodyScripts from '../components/GlobalBodyScripts.astro';
import ShareButtons from '../components/ShareButtons.astro';
import ShareToastContainer from '../components/ShareToastContainer';
import { urlFor, getSiteSettings } from '../lib/sanity';
import { generateShareMessage } from '../lib/shareUtils';
import '../styles/global.css';

interface Props {
  templeData: {
    _id: string;
    name: string;
    slug: string;
    subtitle?: string;
    district: string;
    templeType?: string;
    pageTitle: string;
    metaDescription: string;
    keywords?: string;
    heroSlides?: Array<{
      image: any;
      mobileImage?: any;
      title: string;
      description: string;
    }>;
    heroInfo?: {
      distance?: string;
      duration?: string;
      startingPrice?: string;
    };
    featuredImage?: any;
    videoEmbed?: string;
    introText: string;
    history?: string;
    highlights?: string[];
    customSections?: Array<{
      sectionTitle: string;
      sectionContent: string;
      sectionImage?: any;
    }>;
    timings?: {
      openTime?: string;
      closeTime?: string;
      poojaTimings?: string;
      closedDays?: string;
      specialNote?: string;
    };
    location?: {
      address?: string;
      nearestCity?: string;
      altitude?: string;
      latitude?: number;
      longitude?: number;
      googleMapsEmbedUrl?: string;
    };
    howToReach?: {
      fromKathgodam?: string;
      fromPantnagar?: string;
      fromDelhi?: string;
      nearestRailway?: string;
      nearestAirport?: string;
      distanceFromKathgodam?: string;
    };
    bestTimeToVisit?: string;
    seasonalEvents?: Array<{
      eventName: string;
      timing?: string;
      description?: string;
    }>;
    pilgrimageTips?: string[];
    accommodationInfo?: string;
    carTypes?: Array<{
      name: string;
      model: string;
      capacity: string;
      seasonPrice: string;
      offSeasonPrice: string;
      image: any;
      features: string[];
      popular?: boolean;
    }>;
    exclusions?: string[];
    relatedRoutes?: Array<{
      _id: string;
      from: string;
      to: string;
      slug: string;
      distance: string;
      duration: string;
      startingPrice: string;
    }>;
    relatedPackages?: Array<{
      _id: string;
      name: string;
      slug: string;
      subtitle?: string;
      startingPrice: string;
      duration?: string;
      featuredHomepageImage?: any;
    }>;
    nearbyTemples?: Array<{
      _id: string;
      name: string;
      slug: string;
      subtitle?: string;
      district: string;
      featuredImage?: any;
    }>;
    nearbyAttractions?: Array<{
      _id: string;
      name: string;
      description: string;
      image: any;
      highlights: string[];
    }>;
    taxiCta?: {
      heading?: string;
      subheading?: string;
      primaryRoute?: {
        _id: string;
        from: string;
        to: string;
        slug: string;
        startingPrice: string;
        distance?: string;
        duration?: string;
      };
    };
    faqs?: Array<{
      question: string;
      answer: string;
    }>;
  };
}

const { templeData } = Astro.props;

// Get site settings for contact info
const siteSettings = await getSiteSettings();
const whatsappNumber = siteSettings?.whatsappNumber || '917351721351';
const phone = siteSettings?.phone || '7351721351';
const whatsappMessage = `Hi, I'd like to book a taxi to ${templeData.name}`;
const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(whatsappMessage)}`;

// Generate share URL and message
const pageUrl = `${Astro.site || 'https://kathgodamtaxi.com'}${templeData.slug}`;
const shareMessage = generateShareMessage('temple', {
  templeName: templeData.name,
  district: templeData.district
});

// Prepare hero slides
const heroSlides = templeData.heroSlides?.map(slide => ({
  image: slide.image ? urlFor(slide.image).width(1920).height(1080).url() : '',
  mobileImage: slide.mobileImage ? urlFor(slide.mobileImage).width(768).height(1024).url() : undefined,
  imageAlt: slide.image?.alt || slide.title,
  title: slide.title,
  description: slide.description,
})) || [];

// District labels
const districtLabels: Record<string, string> = {
  'nainital': 'Nainital',
  'almora': 'Almora',
  'champawat': 'Champawat',
  'pithoragarh': 'Pithoragarh',
  'bageshwar': 'Bageshwar',
  'udham-singh-nagar': 'Udham Singh Nagar',
};

// Temple type labels
const templeTypeLabels: Record<string, string> = {
  'shiva': 'Shiva Temple',
  'shakti': 'Shakti Temple',
  'ashram': 'Ashram',
  'heritage': 'Heritage',
  'local': 'Local Deity',
  'pilgrimage': 'Pilgrimage Site',
};

// Default Google Maps embed URL
const mapsEmbedUrl = templeData.location?.googleMapsEmbedUrl ||
  (templeData.location?.latitude && templeData.location?.longitude
    ? `https://maps.google.com/maps?q=${templeData.location.latitude},${templeData.location.longitude}&z=15&output=embed`
    : null);

// Helper function to get default car image based on car name
const getDefaultCarImage = (carName: string): string => {
  const imageMap: Record<string, string> = {
    'Hatchback': '/images/cars/alto.jfif',
    'Sedan': '/images/cars/dzire.jpg',
    'SUV Standard': '/images/cars/tavera.jpg',
    'SUV Deluxe': '/images/cars/innova.jpg',
    'SUV Luxury': '/images/cars/innova-crysta.jpg',
  };
  return imageMap[carName] || '/images/cars/dzire.jpg'; // Default to dzire if not found
};
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <GlobalHeadScripts />
  <title>{templeData.pageTitle}</title>
  <meta name="description" content={templeData.metaDescription} />
  {templeData.keywords && <meta name="keywords" content={templeData.keywords} />}
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="canonical" href={pageUrl} />

  <!-- Open Graph -->
  <meta property="og:title" content={templeData.pageTitle} />
  <meta property="og:description" content={templeData.metaDescription} />
  <meta property="og:type" content="website" />
  <meta property="og:url" content={pageUrl} />
  {heroSlides?.[0]?.image && <meta property="og:image" content={heroSlides[0].image} />}

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={templeData.pageTitle} />
  <meta name="twitter:description" content={templeData.metaDescription} />
  {heroSlides?.[0]?.image && <meta name="twitter:image" content={heroSlides[0].image} />}

  <!-- Structured Data: FAQPage -->
  {templeData.faqs && templeData.faqs.length > 0 && (
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": templeData.faqs.map(faq => ({
        "@type": "Question",
        "name": faq.question,
        "acceptedAnswer": {
          "@type": "Answer",
          "text": faq.answer
        }
      }))
    })} />
  )}

  <!-- Structured Data: BreadcrumbList -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://kathgodamtaxi.com/" },
      { "@type": "ListItem", "position": 2, "name": templeData.name, "item": pageUrl }
    ]
  })} />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://cdn.sanity.io" crossorigin />
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" media="print" onload="this.media='all'" />
</head>

<body class="antialiased">
  <GlobalBodyScripts />
  <!-- Navbar -->
  <Navbar />

  <!-- Main Content -->
  <main>
    <!-- Hero Section -->
    {heroSlides && Array.isArray(heroSlides) && heroSlides.length > 0 ? (
      <RouteHeroSlider
        from=""
        to={templeData.name}
        distance={templeData.heroInfo?.distance || templeData.howToReach?.distanceFromKathgodam || ''}
        duration={templeData.heroInfo?.duration || ''}
        startingPrice={templeData.heroInfo?.startingPrice || ''}
        slides={heroSlides}
      />
    ) : (
      <section class="relative bg-gradient-to-br from-secondary-900 via-black to-secondary-900 text-white min-h-[50vh] flex items-center">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 text-center">
          <div class="inline-flex items-center bg-primary-500 text-black px-4 py-2 rounded-full text-sm font-bold mb-4">
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2L4 7v2h16V7L12 2z"/>
            </svg>
            {templeTypeLabels[templeData.templeType || ''] || 'Sacred Temple'}
          </div>
          <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-4">{templeData.name}</h1>
          {templeData.subtitle && (
            <p class="text-xl md:text-2xl text-gray-300">{templeData.subtitle}</p>
          )}
          <p class="text-lg text-gray-400 mt-4">
            {districtLabels[templeData.district] || templeData.district}, Uttarakhand
          </p>
        </div>
      </section>
    )}

    <!-- Temple Introduction & Info Section -->
    <section class="py-12 bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid lg:grid-cols-3 gap-8">
          <!-- Main Content Column -->
          <div class="lg:col-span-2 space-y-8 min-w-0">
            <!-- Temple Introduction -->
            <div>
              <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
                {templeData.name}
              </h1>
              {templeData.subtitle && (
                <p class="text-xl text-primary-600 italic mb-4">{templeData.subtitle}</p>
              )}
              <div class="prose prose-lg max-w-none text-gray-700 overflow-hidden" set:html={templeData.introText} />
            </div>

            <!-- Key Highlights -->
            {templeData.highlights && Array.isArray(templeData.highlights) && templeData.highlights.length > 0 && (
              <div class="bg-gradient-to-br from-primary-50 to-yellow-50 p-6 rounded-xl border border-primary-200">
                <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                  <svg class="w-6 h-6 text-primary-600 mr-2" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2L4 7v2h16V7L12 2z"/>
                  </svg>
                  Key Highlights
                </h3>
                <ul class="grid md:grid-cols-2 gap-3">
                  {templeData.highlights.map((highlight) => (
                    <li class="flex items-start">
                      <svg class="w-5 h-5 text-primary-600 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                      </svg>
                      <span class="text-gray-700">{highlight}</span>
                    </li>
                  ))}
                </ul>
              </div>
            )}

            <!-- Quick Info Cards -->
            <div class="grid md:grid-cols-4 gap-4">
              <div class="bg-gradient-to-br from-blue-50 to-cyan-50 p-4 rounded-xl border border-blue-200 text-center">
                <svg class="w-8 h-8 text-blue-600 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                </svg>
                <p class="text-lg font-bold text-gray-900">{districtLabels[templeData.district] || templeData.district}</p>
                <p class="text-xs text-gray-600">District</p>
              </div>

              <div class="bg-gradient-to-br from-purple-50 to-pink-50 p-4 rounded-xl border border-purple-200 text-center">
                <svg class="w-8 h-8 text-purple-600 mx-auto mb-2" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 2L4 7v2h16V7L12 2z"/>
                </svg>
                <p class="text-lg font-bold text-gray-900">{templeTypeLabels[templeData.templeType || ''] || 'Temple'}</p>
                <p class="text-xs text-gray-600">Type</p>
              </div>

              {templeData.location?.altitude && (
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-4 rounded-xl border border-green-200 text-center">
                  <svg class="w-8 h-8 text-green-600 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/>
                  </svg>
                  <p class="text-lg font-bold text-gray-900">{templeData.location.altitude}</p>
                  <p class="text-xs text-gray-600">Altitude</p>
                </div>
              )}

              {templeData.howToReach?.distanceFromKathgodam && (
                <div class="bg-gradient-to-br from-yellow-50 to-orange-50 p-4 rounded-xl border border-yellow-200 text-center">
                  <svg class="w-8 h-8 text-yellow-600 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                  </svg>
                  <p class="text-lg font-bold text-gray-900">{templeData.howToReach.distanceFromKathgodam}</p>
                  <p class="text-xs text-gray-600">From Kathgodam</p>
                </div>
              )}
            </div>

            <!-- Share Buttons -->
            <ShareButtons
              pageUrl={pageUrl}
              shareTitle={templeData.name}
              shareMessage={shareMessage}
              layout="horizontal"
            />
          </div>

          <!-- Sidebar Column -->
          <div class="lg:col-span-1">
            <div class="lg:sticky lg:top-24 space-y-6">
              <!-- Temple Timings Card -->
              {templeData.timings && (templeData.timings.openTime || templeData.timings.poojaTimings) && (
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
                <div class="bg-gradient-to-r from-primary-500 to-yellow-500 p-4">
                  <h3 class="text-lg font-bold text-black flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Temple Timings
                  </h3>
                </div>
                <div class="p-4 space-y-3">
                  {templeData.timings.openTime && templeData.timings.closeTime && (
                    <div class="flex items-center justify-between">
                      <span class="text-gray-600">Opening Hours</span>
                      <span class="font-semibold text-gray-900">{templeData.timings.openTime} - {templeData.timings.closeTime}</span>
                    </div>
                  )}
                  {templeData.timings.poojaTimings && (
                    <div>
                      <p class="text-gray-600 mb-1">Pooja/Aarti Timings</p>
                      <p class="text-sm text-gray-800" set:html={templeData.timings.poojaTimings.replace(/\n/g, '<br>')} />
                    </div>
                  )}
                  {templeData.timings.closedDays && (
                    <div class="flex items-center justify-between">
                      <span class="text-gray-600">Closed</span>
                      <span class="text-gray-900">{templeData.timings.closedDays}</span>
                    </div>
                  )}
                  {templeData.timings.specialNote && (
                    <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 text-sm text-amber-800">
                      <strong>Note:</strong> {templeData.timings.specialNote}
                    </div>
                  )}
                </div>
              </div>
            )}

            <!-- Book Taxi CTA Card -->
            <div class="bg-white rounded-xl shadow-lg border-2 border-primary-500 overflow-hidden">
              <div class="bg-gradient-to-r from-primary-500 to-yellow-500 p-4">
                <h3 class="text-lg font-bold text-black">
                  {templeData.taxiCta?.heading || `Book Taxi to ${templeData.name}`}
                </h3>
                {templeData.taxiCta?.subheading && (
                  <p class="text-sm text-black/80">{templeData.taxiCta.subheading}</p>
                )}
              </div>
              <div class="p-4 space-y-4">
                {templeData.taxiCta?.primaryRoute && (
                  <div class="bg-gray-50 rounded-lg p-3">
                    <p class="text-sm text-gray-600">Starting from</p>
                    <p class="text-2xl font-bold text-primary-600">{templeData.taxiCta.primaryRoute.startingPrice}</p>
                    <p class="text-xs text-gray-500">{templeData.taxiCta.primaryRoute.from} → {templeData.taxiCta.primaryRoute.to}</p>
                  </div>
                )}
                <a
                  href={whatsappUrl}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="block w-full bg-whatsapp text-white text-center py-3 rounded-lg font-bold hover:bg-green-600 transition-colors"
                >
                  <span class="flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347"/>
                    </svg>
                    Book on WhatsApp
                  </span>
                </a>
                <a
                  href={`tel:+91${phone}`}
                  class="block w-full bg-secondary-900 text-white text-center py-3 rounded-lg font-bold hover:bg-secondary-800 transition-colors"
                >
                  <span class="flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                    </svg>
                    Call: {phone}
                  </span>
                </a>
              </div>
            </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- History & Significance Section -->
    {templeData.history && (
      <section class="py-12 bg-gray-50">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
          <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center">
            <svg class="w-8 h-8 text-primary-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
            </svg>
            History & Significance
          </h2>
          <div class="prose prose-lg max-w-none text-gray-700" set:html={templeData.history} />
        </div>
      </section>
    )}

    <!-- Custom Sections -->
    {templeData.customSections && Array.isArray(templeData.customSections) && templeData.customSections.length > 0 && templeData.customSections.map((section, index) => (
      <section class={`py-12 ${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}`}>
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class={`grid ${section.sectionImage ? 'lg:grid-cols-2 gap-8 items-center' : ''}`}>
            <div>
              <h2 class="text-3xl font-bold text-gray-900 mb-6">{section.sectionTitle}</h2>
              <div class="prose prose-lg max-w-none text-gray-700" set:html={section.sectionContent} />
            </div>
            {section.sectionImage && (
              <div class="rounded-xl overflow-hidden shadow-lg">
                <img
                  src={urlFor(section.sectionImage).width(800).height(600).url()}
                  alt={section.sectionTitle}
                  class="w-full h-auto object-cover"
                />
              </div>
            )}
          </div>
        </div>
      </section>
    ))}

    <!-- Video Embed -->
    {templeData.videoEmbed && (
      <section class="py-12 bg-gray-900">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
          <h2 class="text-3xl font-bold text-white mb-6 text-center">Watch: {templeData.name}</h2>
          <div class="aspect-video rounded-xl overflow-hidden shadow-2xl">
            <iframe
              src={templeData.videoEmbed.replace('watch?v=', 'embed/')}
              title={`Video about ${templeData.name}`}
              class="w-full h-full"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
            ></iframe>
          </div>
        </div>
      </section>
    )}

    <!-- Festivals & Events -->
    {templeData.seasonalEvents && Array.isArray(templeData.seasonalEvents) && templeData.seasonalEvents.length > 0 && (
      <section class="py-12 bg-gradient-to-br from-primary-50 to-yellow-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">Festivals & Events</h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            {templeData.seasonalEvents.map((event) => (
              <div class="bg-white rounded-xl p-6 shadow-lg border border-primary-200">
                <h3 class="text-xl font-bold text-gray-900 mb-2">{event.eventName}</h3>
                {event.timing && (
                  <p class="text-primary-600 font-semibold mb-3 flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    {event.timing}
                  </p>
                )}
                {event.description && (
                  <p class="text-gray-600 text-sm">{event.description}</p>
                )}
              </div>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- How to Reach -->
    {templeData.howToReach && (
      <section class="py-12 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">How to Reach {templeData.name}</h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            {templeData.howToReach.fromKathgodam && (
              <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-6 border border-blue-200">
                <div class="flex items-center mb-4">
                  <svg class="w-8 h-8 text-blue-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17l-5-5 5-5m12 10V4a2 2 0 00-2-2H9a2 2 0 00-2 2v16a2 2 0 002 2h8"/>
                  </svg>
                  <h3 class="text-lg font-bold text-gray-900">From Kathgodam</h3>
                </div>
                <p class="text-gray-700" set:html={templeData.howToReach.fromKathgodam} />
              </div>
            )}

            {templeData.howToReach.fromPantnagar && (
              <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 border border-purple-200">
                <div class="flex items-center mb-4">
                  <svg class="w-8 h-8 text-purple-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                  </svg>
                  <h3 class="text-lg font-bold text-gray-900">From Pantnagar Airport</h3>
                </div>
                <p class="text-gray-700" set:html={templeData.howToReach.fromPantnagar} />
              </div>
            )}

            {templeData.howToReach.fromDelhi && (
              <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200">
                <div class="flex items-center mb-4">
                  <svg class="w-8 h-8 text-green-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                  </svg>
                  <h3 class="text-lg font-bold text-gray-900">From Delhi</h3>
                </div>
                <p class="text-gray-700" set:html={templeData.howToReach.fromDelhi} />
              </div>
            )}
          </div>

          {/* Nearest Stations Info */}
          <div class="mt-8 grid md:grid-cols-2 gap-4">
            {templeData.howToReach.nearestRailway && (
              <div class="flex items-center bg-gray-50 rounded-lg p-4">
                <svg class="w-6 h-6 text-gray-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17l-5-5 5-5m12 10V4"/>
                </svg>
                <div>
                  <p class="text-sm text-gray-500">Nearest Railway Station</p>
                  <p class="font-semibold text-gray-900">{templeData.howToReach.nearestRailway}</p>
                </div>
              </div>
            )}
            {templeData.howToReach.nearestAirport && (
              <div class="flex items-center bg-gray-50 rounded-lg p-4">
                <svg class="w-6 h-6 text-gray-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                </svg>
                <div>
                  <p class="text-sm text-gray-500">Nearest Airport</p>
                  <p class="font-semibold text-gray-900">{templeData.howToReach.nearestAirport}</p>
                </div>
              </div>
            )}
          </div>
        </div>
      </section>
    )}

    <!-- Pilgrimage Tips -->
    {templeData.pilgrimageTips && Array.isArray(templeData.pilgrimageTips) && templeData.pilgrimageTips.length > 0 && (
      <section class="py-12 bg-gray-50">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
          <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center justify-center">
            <svg class="w-8 h-8 text-primary-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
            </svg>
            Pilgrimage Tips
          </h2>
          <div class="bg-white rounded-xl p-6 shadow-lg">
            <ul class="space-y-3">
              {templeData.pilgrimageTips.map((tip) => (
                <li class="flex items-start">
                  <svg class="w-5 h-5 text-primary-600 mr-3 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                  </svg>
                  <span class="text-gray-700">{tip}</span>
                </li>
              ))}
            </ul>
          </div>
        </div>
      </section>
    )}

    <!-- Best Time to Visit -->
    {templeData.bestTimeToVisit && (
      <section class="py-8 bg-gradient-to-r from-primary-500 to-yellow-500">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
          <h3 class="text-lg font-bold text-black mb-2">Best Time to Visit</h3>
          <p class="text-black/80">{templeData.bestTimeToVisit}</p>
        </div>
      </section>
    )}

    <!-- Optional Pricing Table -->
    {templeData.carTypes && Array.isArray(templeData.carTypes) && templeData.carTypes.length > 0 && (
      <RoutePricingTable
        carTypes={templeData.carTypes.map(car => ({
          name: car.name,
          model: car.model,
          capacity: car.capacity,
          seasonPrice: car.seasonPrice,
          offSeasonPrice: car.offSeasonPrice,
          image: car.image
            ? (typeof car.image === 'string' ? car.image : urlFor(car.image).width(400).height(300).url())
            : getDefaultCarImage(car.name),
          features: car.features && Array.isArray(car.features) ? car.features : [],
          popular: car.popular || false
        }))}
        exclusions={templeData.exclusions}
      />
    )}

    <!-- Related Routes (Taxi CTA) -->
    {templeData.relatedRoutes && Array.isArray(templeData.relatedRoutes) && templeData.relatedRoutes.length > 0 && (
      <section class="py-12 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">Taxi Routes to {templeData.name}</h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            {templeData.relatedRoutes.map((route) => (
              <a href={`/${route.slug}`} class="group bg-white rounded-xl shadow-lg border-2 border-gray-200 hover:border-primary-500 overflow-hidden transition-all">
                <div class="bg-gradient-to-r from-gray-900 to-gray-800 p-4 text-white">
                  <h3 class="font-bold text-lg">{route.from} → {route.to}</h3>
                </div>
                <div class="p-4">
                  <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="text-center">
                      <p class="text-sm text-gray-500">Distance</p>
                      <p class="font-bold text-gray-900">{route.distance}</p>
                    </div>
                    <div class="text-center">
                      <p class="text-sm text-gray-500">Duration</p>
                      <p class="font-bold text-gray-900">{route.duration}</p>
                    </div>
                  </div>
                  <div class="text-center border-t border-gray-200 pt-4">
                    <p class="text-sm text-gray-500">Starting From</p>
                    <p class="text-2xl font-bold text-primary-600">{route.startingPrice}</p>
                  </div>
                  <div class="mt-4 text-center text-primary-600 font-semibold group-hover:text-primary-700">
                    View Route Details →
                  </div>
                </div>
              </a>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- Related Packages -->
    {templeData.relatedPackages && Array.isArray(templeData.relatedPackages) && templeData.relatedPackages.length > 0 && (
      <section class="py-12 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">Tour Packages Including {templeData.name}</h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            {templeData.relatedPackages.map((pkg) => (
              <a href={`/${pkg.slug}`} class="group bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-all">
                {pkg.featuredHomepageImage && (
                  <div class="h-48 overflow-hidden">
                    <img
                      src={urlFor(pkg.featuredHomepageImage).width(400).height(300).url()}
                      alt={pkg.name}
                      class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
                    />
                  </div>
                )}
                <div class="p-4">
                  <h3 class="font-bold text-lg text-gray-900 group-hover:text-primary-600 transition-colors">{pkg.name}</h3>
                  {pkg.subtitle && <p class="text-sm text-gray-600 mb-2">{pkg.subtitle}</p>}
                  <div class="flex items-center justify-between">
                    {pkg.duration && <span class="text-sm text-gray-500">{pkg.duration}</span>}
                    <span class="font-bold text-primary-600">{pkg.startingPrice}</span>
                  </div>
                </div>
              </a>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- Nearby Temples -->
    {templeData.nearbyTemples && Array.isArray(templeData.nearbyTemples) && templeData.nearbyTemples.length > 0 && (
      <section class="py-12 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">Nearby Temples</h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            {templeData.nearbyTemples.map((temple) => (
              <a href={`/${temple.slug}`} class="group bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200 hover:border-primary-500 transition-all">
                {temple.featuredImage && (
                  <div class="h-40 overflow-hidden">
                    <img
                      src={urlFor(temple.featuredImage).width(300).height(200).url()}
                      alt={temple.name}
                      class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
                    />
                  </div>
                )}
                <div class="p-4">
                  <h3 class="font-bold text-gray-900 group-hover:text-primary-600 transition-colors">{temple.name}</h3>
                  {temple.subtitle && <p class="text-sm text-gray-600 italic">{temple.subtitle}</p>}
                  <p class="text-xs text-gray-500 mt-1">{districtLabels[temple.district] || temple.district}</p>
                </div>
              </a>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- Nearby Attractions -->
    {templeData.nearbyAttractions && Array.isArray(templeData.nearbyAttractions) && templeData.nearbyAttractions.length > 0 && (
      <AttractionsGrid
        title={`Places to Visit Near ${templeData.name}`}
        attractions={templeData.nearbyAttractions.map(attr => ({
          name: attr.name,
          description: attr.description,
          image: attr.image ? urlFor(attr.image).width(400).height(400).url() : '',
          highlights: attr.highlights
        }))}
      />
    )}

    <!-- Map & FAQs Section -->
    <section class="py-12 bg-gray-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid lg:grid-cols-2 gap-8">
          <!-- Google Maps -->
          {mapsEmbedUrl && (
            <div>
              <h2 class="text-2xl font-bold text-gray-900 mb-4">Location</h2>
              <div class="bg-white rounded-xl overflow-hidden shadow-lg border border-gray-200">
                <iframe
                  src={mapsEmbedUrl}
                  width="100%"
                  height="400"
                  style="border:0;"
                  allowfullscreen=""
                  loading="lazy"
                  referrerpolicy="no-referrer-when-downgrade"
                  title={`Location of ${templeData.name}`}
                ></iframe>
              </div>
              {templeData.location?.address && (
                <p class="mt-4 text-gray-600 text-sm">
                  <strong>Address:</strong> {templeData.location.address}
                </p>
              )}
            </div>
          )}

          <!-- FAQs -->
          {templeData.faqs && Array.isArray(templeData.faqs) && templeData.faqs.length > 0 && (
            <div>
              <h2 class="text-2xl font-bold text-gray-900 mb-4">Frequently Asked Questions</h2>
              <div class="space-y-4">
                {templeData.faqs.map((faq) => (
                  <details class="group bg-white rounded-lg border border-gray-200 overflow-hidden">
                    <summary class="flex justify-between items-center cursor-pointer p-4 hover:bg-gray-50 transition-colors">
                      <h3 class="font-semibold text-gray-900 pr-4">{faq.question}</h3>
                      <svg class="w-5 h-5 text-gray-500 group-open:rotate-180 transition-transform flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                      </svg>
                    </summary>
                    <div class="p-4 pt-0 text-gray-600 leading-relaxed" set:html={faq.answer} />
                  </details>
                ))}
              </div>
            </div>
          )}
        </div>
      </div>
    </section>

    <!-- Accommodation Info -->
    {templeData.accommodationInfo && (
      <section class="py-12 bg-white">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
          <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center justify-center">
            <svg class="w-8 h-8 text-primary-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
            </svg>
            Where to Stay
          </h2>
          <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-6 border border-blue-200">
            <div class="prose prose-lg max-w-none text-gray-700" set:html={templeData.accommodationInfo} />
          </div>
        </div>
      </section>
    )}

    <!-- Final CTA -->
    <section class="py-12 bg-gradient-to-r from-primary-500 via-yellow-500 to-primary-500">
      <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-3xl md:text-4xl font-bold text-black mb-4">
          Ready to Visit {templeData.name}?
        </h2>
        <p class="text-lg text-black/80 mb-8 max-w-2xl mx-auto">
          Book a comfortable taxi from Kathgodam to {templeData.name}. Fixed prices, reliable drivers, and hassle-free pilgrimage experience.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a
            href={whatsappUrl}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center justify-center bg-whatsapp text-white px-8 py-4 rounded-lg font-bold hover:bg-green-600 transition-all shadow-lg text-base"
          >
            <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347"/>
            </svg>
            Book on WhatsApp
          </a>
          <a
            href={`tel:+91${phone}`}
            class="inline-flex items-center justify-center bg-black text-white px-8 py-4 rounded-lg font-bold hover:bg-gray-900 transition-all shadow-lg text-base"
          >
            <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
            </svg>
            Call: {phone}
          </a>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <Footer />

  <!-- WhatsApp FAB -->
  <WhatsAppFAB />

  <!-- Share Toast -->
  <ShareToastContainer client:idle />

  <style>
    html {
      scroll-behavior: smooth;
    }

    main {
      margin-top: 64px;
    }

    @media (min-width: 768px) {
      main {
        margin-top: 80px;
      }
    }

    /* Ensure prose content doesn't break grid layout */
    .prose img,
    .prose table,
    .prose pre,
    .prose iframe,
    .prose video {
      max-width: 100%;
      height: auto;
    }

    .prose table {
      display: block;
      overflow-x: auto;
    }

    /* Ensure custom content divs don't break layout */
    .prose .temple-history,
    .prose > div {
      max-width: 100%;
      overflow-wrap: break-word;
      word-wrap: break-word;
    }

    .prose hr {
      max-width: 100%;
      margin: 2rem 0;
    }
  </style>
</body>
</html>
